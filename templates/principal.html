<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Página Inicial</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
        integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
    <div class="container">
        <div class="sidebar">
            <button id="btn-estoque" class="btn-estoque">
                <i class="fas fa-box-open"></i> Estoque
            </button>
            <button id="btn-estoque" class="btn-estoque">
                <i class="fas fa-chart-bar"></i> Estatísticas
            </button>
        </div>
        <div id="estoque-container" style="display: none;">
            <!-- O conteúdo de estoque.html será carregado aqui -->
        </div>
    </div>
    <script>
        let estoqueVisivel = false;
        let estatisticasVisivel = false;

        function carregarEstoque() {
            fetch('/estoque')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('estoque-container').innerHTML = data;
                    adicionarEventListeners();
                });
        }

        function carregarEstatisticas() {
            fetch('/estatisticas')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('estoque-container').innerHTML = data;
                });
        }

        function adicionarEventListeners() {
            window.toggleForm = function () {
                const formContainer = document.getElementById('form-container');
                formContainer.classList.toggle('visible');
            }

            $('#form-adicionar').off('submit').on('submit', function (event) {
                event.preventDefault();
                $.post('/adicionar', $(this).serialize())
                    .done(function (response) {
                        carregarEstoque();
                    })
                    .fail(function (error) {
                        alert('Erro: ' + error.responseJSON.message);
                    });
            });

            $(document).off('click', '.btn-consumir').on('click', '.btn-consumir', function (event) {
                event.preventDefault();
                var itemId = $(this).data('item-id');
                $.get('/consumir/' + itemId)
                    .done(function (response) {
                        carregarEstoque();
                    })
                    .fail(function (error) {
                        alert('Erro: ' + error.responseJSON.message);
                    });
            });

            $(document).off('submit', '.form-editar').on('submit', '.form-editar', function (event) {
                event.preventDefault();
                var itemId = $(this).data('item-id');
                $.post('/editar/' + itemId, $(this).serialize())
                    .done(function (response) {
                        carregarEstoque();
                    })
                    .fail(function (error) {
                        alert('Erro: ' + error.responseJSON.message);
                    });
            });

            $(document).off('click', '.btn-excluir').on('click', '.btn-excluir', function () {
                var itemId = $(this).data('item-id');
                if (confirm('Tem certeza?')) {
                    $.post('/excluir/' + itemId)
                        .done(function (response) {
                            carregarEstoque();
                        })
                        .fail(function (error) {
                            alert('Erro: ' + error.responseJSON.message);
                        });
                }
            });

            $(document).off('click', '.btn-editar').on('click', '.btn-editar', function () {
                var itemId = $(this).data('item-id');
                $('#edit-form-' + itemId).toggle();
            });

          // Evento para cancelar a edição
            $(document).off('click', '.btn-editar-cancelar').on('click', '.btn-editar-cancelar', function (event) {
                var itemId = $(this).closest('.edit-form').data('item-id');
                $('#edit-form-' + itemId).hide(); // Esconde o formulário de edição
            });

            // Evento de click nos itens de estatistica
            $(document).off('click', '.item-nome').on('click', '.item-nome', function (event) {
                var itemId = $(this).parent().attr('data-item-id');
                console.log(itemId)
                $(`.item[data-item-id='${itemId}'] > .consumo-lista`).slideToggle()
            });
        }

        // Função genérica para exibir a aba selecionada
        function toggleAba(aba) {
            let abaVisivel = aba === 'estoque' ? estoqueVisivel : estatisticasVisivel;

            // Esconde todas as abas
            estoqueVisivel = false;
            estatisticasVisivel = false;
            document.getElementById('estoque-container').style.display = 'none';
            document.getElementById('estoque-container').innerHTML = '';

            // Se a aba clicada não estava visível, exibe-a
            if (!abaVisivel) {
                if (aba === 'estoque') {
                    estoqueVisivel = true;
                    carregarEstoque();
                } else if (aba === 'estatisticas') {
                    estatisticasVisivel = true;
                    carregarEstatisticas();
                }
                document.getElementById('estoque-container').style.display = 'block';
            }
        }

        document.getElementById('btn-estoque').addEventListener('click', function () {
            toggleAba('estoque');
        });

        document.getElementById('btn-estatisticas').addEventListener('click', function () {
            toggleAba('estatisticas');
        });
    </script>
</body>

</html>